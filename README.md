# ğŸš€ aZent(æ ‡å‡†ç‰ˆ)

## aZent æ˜¯ä¸ªå•¥
è½»é‡çº§å¤š Agent åä½œçš„ AI Agent æ¡†æ¶(æ ‡å‡†ç‰ˆ)

## aZent çš„ç›®æ ‡äººç¾¤æ˜¯è°

ä¼šä¸“æ³¨äºå‡ ä¸ªé€‚åˆå¼•å…¥ AI çš„é¢†åŸŸã€ä¾‹å¦‚ç¿»è¯‘åä½œã€æ•°æ®åˆ†æã€è¾…åŠ©å¼€å‘ã€‚ä¸“æ³¨å‡ ä¸ªé¢†åŸŸæ·±æŒ–ï¼Œæ”¶é›†é—®é¢˜å½¢æˆé’ˆå¯¹è¿™äº›é¢†åŸŸçš„è§£å†³æ–¹æ¡ˆã€‚é€šè¿‡Agentå¢å¼ºLLMç¨³å®šæ€§ã€å¯æ§æ€§ï¼Œä»è€Œæå‡ Agent ä»·å€¼ã€‚

## åº”ç”¨åœºæ™¯
- ğŸ“° ç¿»è¯‘åä½œ
- ğŸ“Š æ•°æ®åˆ†æ
- â˜•ï¸ è¾…åŠ©å¼€å‘

## ç‰¹ç‚¹
- é¢å‘è½åœ°ï¼Œæ¯ä¸€è¡Œä»£ç éƒ½æ˜¯ä¸ºäº† AI èƒ½å¤Ÿè§¦åœ°è€Œå†™
- ä¸åšé€šç”¨ï¼Œé€šè¿‡ä¸æ–­å®è·µæ¥æ¢ç©¶ AI é¢†åŸŸçš„ç‰¹å®šé¢†åŸŸçš„è½è„šç‚¹ï¼Œé€šè¿‡å¯¹äºä¸šåŠ¡æ·±å…¥äº†è§£ï¼Œé€šè¿‡å…ˆéªŒæ¥å‡å°‘ä¸å¿…è¦é—®é¢˜
- é€šè¿‡æœºå™¨å­¦ä¹ åŠ æŒï¼Œå‹ç¼© LLM è‡ªç”±åº¦
- æ— æ„Ÿåˆ‡å…¥ï¼Œå¸Œæœ›æ— éœ€ä»»ä½•æˆæœ¬ï¼Œå°±å¯ä»¥å°† LLM å¼•å…¥åˆ°ç°æœ‰ç³»ç»Ÿï¼Œç”šè‡³æ¸—é€åˆ°å‡½æ•°è¿™ä¸€ä¸ªåŸºç¡€çš„å•å…ƒ
- å¯¹äº **æ ‡å‡†ç‰ˆ** å¸Œæœ›ä»–ä¸ä»…ä»…æ˜¯ä¸€ä¸ª Agent æ¡†æ¶ï¼Œè€Œæ˜¯ä¸€ç‰ˆæ•™ä½ å¦‚ä½•å†™è‡ªå·± Agent çš„è¿‡ç¨‹ä¹¦ï¼Œæ¯ä¸€æ¬¡æäº¤éƒ½å¯èƒ½æ˜¯ä¸€ä¸ª python çš„è¯­æ³•ï¼Œéƒ½æ˜¯ä¸€ä¸ªè§£å†³æ–¹æ¡ˆï¼Œä¸€ä¸ªç‰¹å¾
- ä»–æ˜¯å˜åŒ–çš„ï¼Œä¸è¿‡å¼•å…¥æ–°çš„ç‰¹å¾ï¼Œä»¥ä¾¿äºé€‚åº”å½“å…ˆ LLM å¿«é€Ÿçš„è¿­ä»£
- æœ€å°é›†ï¼Œå¸Œæœ›åœ¨ä¸æ–­è·Ÿéš LLM è¿‡ç¨‹è®©ç‰ˆæœ¬åˆ‡æ¢æˆæœ¬è¾¾åˆ°æœ€å°

## ç¤ºä¾‹

## ğŸ˜€ hello ç¬¬ä¸€è¡Œä»£ç 
### å‡†å¤‡
å¦‚ä½•æƒ³è¦æ¥å…¥ deepseek æ¨¡å‹ï¼Œéœ€è¦å‡†å¤‡ api_key
- æ‰“å¼€ deepseek å®˜ç½‘
- æ³¨å†Œä¸€ä¸ª deepseek è´¦å·
- æ¥ä¸‹æ¥ç”³è¯· api_key ä½œä¸º DEEPSEEK_API_KEY 
ğŸ˜€ æ³¨æ„è¦æŠŠè´¦å·ä¿å­˜å¥½å‘€

### åˆå§‹åŒ– client ğŸ‰
ä¸€åˆ‡ä» Hello world å¼€å§‹ï¼Œä½ çš„ deepseeker âœˆï¸ ä¹‹æ—…ä¹Ÿæ˜¯ä» Hello ä¾‹å­å¼€å§‹ã€‚é¦–å…ˆåˆå§‹åŒ–ä¸€ä¸ª client ï¼Œclient å¯¹åº”ä¸€ä¸ª LLM ä¾›åº”å•†ï¼Œæˆ–è€…å¯¹åº”æœ¬åœ°èµ·çš„ LLM æœåŠ¡ï¼Œä¾‹å¦‚ ollamaã€‚ä¸ªäººè¿™é‡Œå¹¶ä¸æ¨èä½¿ç”¨ã€‚

```python
client =  DeepSeekClient(
        name="deepseek-client",
        api_key = DEEPSEEK_API_KEY,
        base_url = DEEPSEEK_BASE_URL)
```
éœ€è¦å‡†å¤‡ä¸€ä¸ª api_key deepseek å…³æ³¨æ³¨å†Œä¸€ä¸ªè´¦å·ï¼Œå› ä¸ºæ˜¯éœ€è¦ api_key 


### ğŸ“ å‡†å¤‡ç³»ç»Ÿæ¶ˆæ¯(SystemMessage)å’Œç”¨æˆ·æ¶ˆæ¯(HumanMessage)
```python
system_message = SystemMessage(content="you are very help assistant")
human_message = HumanMessage(content="write hello world in python")
```
è¿™é‡Œ system_message è®¾è®¡æ¯”è¾ƒçµæ´»ï¼Œå¯ä»¥é€šè¿‡å¤šç§æ–¹å¼åˆ›å»º system_messageï¼Œåœ¨åé¢ä¾‹å­å¤§å®¶å°±èƒ½çœ‹åˆ°æ›´å¤šæ–¹å¼æ¥å®šä¹‰ system_message

### å®šä¹‰ä¸€ä¸ª ğŸ¤– Agent
```python
agent = Agent(
    name="simple_agent",
    system_message=system_message,
    )
```
ç®€ç®€å•å•çš„é…ç½®å°±å¯ä»¥å®Œæˆ Agent åˆå§‹åŒ–ã€‚åœ¨ Agent è®¾è®¡æ—¶ï¼Œå€Ÿé‰´äº†å¾ˆå¤šæ¡†æ¶ä¸­ Agent æ¨¡æ ·ï¼Œå…·ä½“ Agent åº”è¯¥é•¿ä»€ä¹ˆæ ·å‘¢? æœ€åçš„è®¾è®¡æ˜¯æƒ³è®©å¼€å‘äººå‘˜åªè¦è¾ƒå°‘çš„å‚æ•°ã€‚å°±å¯ä»¥åˆ›å»ºå‡ºæ¥ä¸€ä¸ª Agentï¼Œè€Œä¸”è¿˜èƒ½å¤Ÿæ»¡è¶³ Agent åŸºæœ¬èƒ½åŠ›ã€‚æ‰€ä»¥è¿™æ˜¯ç°åœ¨å¤§å®¶çœ‹åˆ° Agent æ¨¡æ ·ï¼Œä¸€äº›åŸºæœ¬çš„å‚æ•°å°±å¯ä»¥åˆ›å»ºå‡ºä¸€ä¸ª Agentã€‚

ä¸€åˆ‡å‡†å¤‡å¥½äº†ï¼Œå°±å¯ä»¥å¼€å§‹è¿è¡Œ Agent äº†ï¼Œè¿™é‡Œè¦è¡¥å……ä¸€ç‚¹ï¼Œåœ¨ azent æ¡†æ¶è®¾è®¡ä¸­ï¼Œä¸€åˆ‡éƒ½æ˜¯ä¼˜å…ˆè€ƒè™‘æ”¯æŒå¼‚æ­¥è°ƒç”¨ï¼Œä¸ºä»€ä¹ˆè¿™æ ·åšï¼ŒåŸå› ä¹Ÿæ˜¯ä¸å¿…å¤šè¯´äº†ã€‚


```python
async def main():
    result = await agent.run(human_message)
    if result:
        console.print(result.get_text())
if __name__ == "__main__":
    asyncio.run(main=main())
```
å®Œæ•´ä»£ç å¦‚ä¸‹
```python
import asyncio

from rich.console import Console
from rich.markdown import Markdown

from azent.core import DeepSeekClient,Agent
from azent.core.message import HumanMessage,SystemMessage
console = Console()

# åˆå§‹åŒ–ä¸€ä¸ª client
client = DeepSeekClient(name="deepseek-client")

system_message = SystemMessage(content="you are very help assistant")
human_message = HumanMessage(content="write hello world in python")


agent = Agent(
    name="simple_agent",
    system_message=system_message,
    )

async def main():
    result = await agent.run(human_message)
    if result:
        console.print(result.get_text())
if __name__ == "__main__":
    asyncio.run(main=main())
```

å½“ç„¶é€šå¸¸ä¹Ÿæ”¯æŒåŒæ­¥æ–¹å¼æ¥è¿è¡Œ Agentï¼Œå…·ä½“æ–¹æ³•å¦‚ä¸‹

```python

if __name__ == "__main__":
    result = agent.sync_run(human_message)
    if result:
        console.print(result.get_text())
```


### demo 2 æ»¡è¶³ç»“æ„åŒ–è¾“å‡ºï¼Œç”Ÿæˆ ğŸ• æ•°æ®

## ç»“æ„åŒ–è¾“å‡ºé‡è¦æ€§

**ç»“æ„åŒ–è¾“å‡º**æ˜¯æŒ‡ LLM ç”Ÿæˆçš„ç»“æœï¼ŒæŒ‰é¢„å®šä¹‰çš„æ ¼å¼æˆ–æ¨¡å¼æ¥è¾“å‡ºï¼Œä¾‹å¦‚ JSONã€XMLã€è¡¨æ ¼ã€åˆ—è¡¨ç­‰ã€‚è¿™ç§èƒ½åŠ›å¯¹äº LLM åœ¨å®é™…åº”ç”¨ä¸­è‡³å…³é‡è¦ï¼ŒåŸå› å¦‚ä¸‹ï¼š

- å…¼å®¹ç°æœ‰ç³»ç»Ÿ
- æå‡å¯æ§æ€§
- é€šå‘å¤šå¤šæ¨¡æ€çš„æ¥å£ã€‚

ç®€åŒ–åç»­å¤„ç†: å°† LLM çš„è¾“å‡ºç»“æ„åŒ–ä¸º Pydantic æ¨¡å‹åï¼ŒAgent å¯ä»¥ç›´æ¥è®¿é—®å’Œæ“ä½œè¿™äº›æ•°æ®ï¼Œè€Œæ— éœ€è¿›è¡Œé¢å¤–çš„æ–‡æœ¬è§£æå·¥ä½œï¼Œä»è€Œç®€åŒ–äº†åç»­çš„é€»è¾‘å¤„ç†ã€‚

ç»“æ„åŒ–è¾“å‡ºï¼Œè½»æ¾æ¥å…¥åˆ°ç°æœ‰ç³»ç»Ÿï¼Œæˆ‘è§‰å¾—ç»“æ„åŒ–è¾“å‡ºå’Œå·¥å…·è°ƒç”¨æ˜¯ç°ä»£ LLM å¿…å¤‡çš„ä¸¤ç§æŠ€èƒ½ï¼Œå¦‚æœè¿˜æ²¡æœ‰è¿™ 2 ä¸ªæŠ€èƒ½å°±å¾ˆéš¾æ··äº†ã€‚æ¥ä¸‹æ¥å°±é€šè¿‡ç”Ÿæˆ ğŸ• æ•°æ®ä¸ºæ¼”ç¤ºé€šè¿‡ Agent è®©ä½ å¯ä»¥çœåŠ›è®© deepseek ç»™å‡ºç»“æ„åŒ–è¾“å‡ºï¼Œå’Œä¸Šä¸€ä¸ªä¾‹å­é‡å¤å°±ä¸å†é‡å¤äº†ã€‚


é¦–å…ˆæ˜¯å®šä¹‰æ•°æ®ç»“æ„ï¼Œè¿™æ˜¯ä¸€ä¸ªåµŒå¥—æ•°æ®ç»“æ„ï¼ŒPizza ğŸ• å’Œä¸€ä¸ª Pizza ğŸ•ğŸ•ğŸ•åˆ—è¡¨çš„æ•°æ®ã€‚

ğŸ“¢ **æç¤º**: ç»“æ„åŒ–è¾“å‡ºè¿™é‡Œåœ¨ `v2` ç‰ˆæœ¬ä¹Ÿåšä¸€å®šçš„ä¼˜åŒ–ï¼Œå°±æ˜¯è¿”å›ç±»å‹é›†åˆæƒ…å†µï¼Œä¸å†éœ€è¦å®šä¹‰è¯¥ç±»å‹é›†åˆç±»æ¥æ¥å—è¾“å‡ºç»“æ„ï¼Œå¯ä»¥é€šè¿‡ `list[Pizza]` æ¥å‘Šè¯‰ Agent è¿”å›çš„ç±»å‹ä¸º `Pizza` çš„é›†åˆç±»å‹ã€‚

ğŸš¨ **æ³¨æ„**: è¿™é‡ŒæŒ‡å®šè¿”å›ç»“æ„åŒ–çš„æ•°æ®ç±»å‹ä¿®æ”¹ä¸º ç”¨ `result_data_type` æ¥æŒ‡å®šï¼Œè€Œä¸å†æ˜¯ `result_type` ã€‚è¿™é‡Œ `result_type` å…·æœ‰æ–°çš„å«ä¹‰ï¼Œè¡¨ç¤º `agent.run` æˆ–è€… `agent.sync_run` è¿”å›ç»“æ„ç±»å‹ã€‚æ‰€ä»¥è¿›è¡Œè¿™æ ·ä¿®æ”¹å°±æ˜¯ä¸ºäº†å¯ä»¥é€šè¿‡å‚æ•°åå­—å¯ä»¥å‡†ç¡®è¡¨è¾¾å‚æ•°ç”¨é€”ã€‚

ä¾‹å¦‚
```python
class PizzaList(BaseModel):
    pizza_list:List[Pizza] = Field(title="pizza list",description="ç»™å‡ºä¸€ä¸ªæŠ«è¨åˆ—è¡¨",examples=[f"""
{_json_schema_to_example(Pizza)}
"""])
```
ä¾‹å¦‚æ— éœ€å†å»æŒ‡å®š `PizzaList` ä½œä¸º `Pizza` é›†åˆç±»çš„ç±»å‹ï¼Œç›´æ¥æŒ‡å®š `list[Pizza]` å³å¯

```python
class Pizza(BaseModel):
    name:str = Field(title="name of pizza",description="æŠ«è¨çš„åç§°",examples=["æµ·é²œæŠ«è¨"])
    description:str = Field(title="description of pizza",description="å¯¹äºæŠ«è¨çš„ç®€å•ä»‹ç»",examples=["ä¸°å¯Œçš„æµ·é²œå¦‚è™¾ã€é±¿é±¼å’Œè´»è´æ­é…ç•ªèŒ„é…±å’Œå¥¶é…ªï¼Œæµ·æ´‹çš„å‘³é“åœ¨å£ä¸­çˆ†å‘ã€‚"])

class PizzaList(BaseModel):
    pizza_list:List[Pizza] = Field(title="pizza list",description="ç»™å‡ºä¸€ä¸ªæŠ«è¨åˆ—è¡¨",examples=[f"""
{_json_schema_to_example(Pizza)}
"""])
```
**æç¤º**: ğŸ“¢ æš‚æ—¶åªæ”¯æŒ pydantic çš„ BaseModel ç±»å‹çš„æ•°æ®ï¼Œå¦‚æœåˆå…¶ä»–ç±»å‹ï¼Œå¯ä»¥å°†å…¶è½¬æ¢ä¸º pydantic ç±»å‹

```python

from rich.console import Console
from rich.markdown import Markdown
from typing import List
from pydantic import BaseModel,Field
from rich.panel import Panel
from azent.core import DeepSeekClient,Agent
from azent.core.message import HumanMessage,SystemMessage
from azent.core.utils import _json_schema_to_example

console = Console()
# å®šä¹‰æ•°æ®æ•°æ®ç»“æ„ï¼Œç°åœ¨ä»…æ”¯æŒ BaseModel ç±»å‹
# å¹¶ä¸”éœ€è¦ç»™å‡ºä¾‹å­ï¼ŒğŸ“¢è¿™ä¸€ç‚¹æ¯”è¾ƒé‡è¦
class Pizza(BaseModel):
    name:str = Field(title="name of pizza",description="æŠ«è¨çš„åç§°",examples=["æµ·é²œæŠ«è¨"])
    description:str = Field(title="description of pizza",description="å¯¹äºæŠ«è¨çš„ç®€å•ä»‹ç»",examples=["ä¸°å¯Œçš„æµ·é²œå¦‚è™¾ã€é±¿é±¼å’Œè´»è´æ­é…ç•ªèŒ„é…±å’Œå¥¶é…ªï¼Œæµ·æ´‹çš„å‘³é“åœ¨å£ä¸­çˆ†å‘ã€‚"])



system_message = SystemMessage(content="you are very help assistant")
human_message = HumanMessage(content="ç”Ÿæˆ 10 ç§ä»¥ä¸ŠæŠ«è¨")

# å®šä¹‰ä¸€ä¸ª Agent
agent = Agent(
    name="pizza_generator",
    model_name="deepseek-chat",
    system_message=system_message,
    # ğŸ“¢  éœ€è¦åœ¨åˆå§‹åŒ– Agent æ—¶å€™æŒ‡å®šä¸€äº›è¾“å‡ºæ•°æ®ç»“æ„
    result_type=list[Pizza]
    )

async def main():
    result = await agent.run(human_message)
    for pizza in result.get_data():
        console.print(Panel(pizza.description,title=f"ğŸ• {pizza.name}"))
    
if __name__ == "__main__":
    asyncio.run(main=main())
    
```

ä½ æåˆ°çš„è¿™ä¸¤ç§æ–¹æ¡ˆéƒ½æ˜¯åœ¨ LLM æœ¬èº«ä¸ç›´æ¥æ”¯æŒæˆ–éš¾ä»¥ä¿è¯å®Œå…¨ç»“æ„åŒ–è¾“å‡ºæ—¶ï¼Œå°†éç»“æ„åŒ–æˆ–åŠç»“æ„åŒ–è¾“å‡ºè½¬åŒ–ä¸ºç»“æ„åŒ–æ•°æ®çš„æœ‰æ•ˆæ–¹æ³•ã€‚æˆ‘ä»¬æ¥åˆ†åˆ«æ¢è®¨ä¸€ä¸‹è¿™ä¸¤ç§æ–¹æ¡ˆçš„ç»†èŠ‚å’Œé€‚ç”¨åœºæ™¯ã€‚

æ–¹æ¡ˆä¸€ï¼šPrompt å¼•å¯¼ JSON è¾“å‡º + json_extract + Pydantic æ¨¡å‹

è¿™ç§æ–¹æ¡ˆçš„æ ¸å¿ƒæ€æƒ³æ˜¯å¼•å¯¼ LLM å°½é‡è¾“å‡º JSON æ ¼å¼çš„æ•°æ®ï¼Œå³ä½¿å®ƒæœ¬èº«ä¸å…·å¤‡å¼ºç»“æ„åŒ–è¾“å‡ºçš„èƒ½åŠ›ï¼Œç„¶åé€šè¿‡åå¤„ç†çš„æ–¹å¼æå–å’Œæ ¡éªŒ JSON æ•°æ®ï¼Œå¹¶æœ€ç»ˆè½¬æ¢ä¸º Pydantic æ¨¡å‹ã€‚

æ–¹æ¡ˆäºŒï¼šä½¿ç”¨æ”¯æŒç»“æ„åŒ–è¾“å‡ºçš„ Agent åˆ†æå’Œæå–

è¿™ç§æ–¹æ¡ˆåˆ©ç”¨äº† Agent æ¡†æ¶ï¼ˆå¦‚ LangChainã€AutoGen ç­‰ï¼‰ä¸­å…·å¤‡æ›´å¼ºé€»è¾‘å’Œå·¥å…·è°ƒç”¨èƒ½åŠ›çš„ Agentï¼Œæ¥åˆ†æ LLM çš„åŸå§‹è¾“å‡ºï¼Œå¹¶æ ¹æ®é¢„å®šä¹‰çš„ç»“æ„æå–æ‰€éœ€çš„ä¿¡æ¯ã€‚

## ğŸ˜€ å…³äº deps ç¤ºä¾‹

æœ‰æ—¶å€™ä¼šæœ‰è¿™æ ·çš„åœºæ™¯ï¼Œé€šå¸¸éœ€è¦è·å–å¤–éƒ¨èµ„æºï¼Œè¿™é‡Œå¤–éƒ¨å¯ä»¥æ˜¯é€šè¿‡ http è¯·æ±‚è·å–èµ„æºï¼Œæˆ–è€…æˆ‘ä»¬è¿æ¥æ•°æ®åº“æ¥è·å–èµ„æºï¼Œä¹Ÿèƒ½è¯»å–æœ¬åœ°æ–‡ä»¶ã€‚å°†è¿™äº›èµ„æºæ•´åˆåˆ° contextï¼Œä¾‹å¦‚æˆ‘ä»¬éœ€è¦é˜…è¯»é‚®ä»¶ï¼Œéœ€è¦é€šè¿‡é‚®ä»¶æ¥å£æ¥è·å–é‚®ä»¶å†…å®¹ã€‚

è¿™äº›èµ„æºéƒ½æ˜¯å¤–éƒ¨ï¼Œè€Œä¸”åŠ¨æ€çš„ï¼Œéƒ½æ˜¯å®æ—¶è·å–èµ„æºã€‚æ‰€ä»¥å¯åŠ¨ Agent ä¹‹å‰éœ€è¦å»è¿æ¥èµ„æºï¼Œæ¥é€šèµ„æºã€‚è¿™å°±æ˜¯ deps è®¾è®¡çš„ç›®çš„ã€‚



### å®šä¹‰ä¾èµ–æ•°æ®ç»“æ„
```python
@dataclass
class Deps:
    conn:httpx.AsyncClient
    url:str
```
- å®šä¹‰ Deps æ•°æ®ç”¨äºè¿æ¥æœåŠ¡APIçš„å®¢æˆ·ç«¯
- url 


```python
async def system_message(context):
    conn = context['deps'].conn
    try:
        response = await conn.get(context['deps'].url)
        response.raise_for_status()
        if response.status_code == 200:
            pokemon_list = [ Pokemon(name=item['name'],description="") for item in response.json()['results']]
            return f"""
        åŸºäº **Pokemon** å‡ºç°çš„ Pokemon ç»™ä¸ç®€å•è¯´æ˜ï¼Œå°±ä¸€å¥è¯
        ** Pokemon **
        {",".join([ pokemon.name for pokemon in pokemon_list])}

        """
        else:
            return f"è¯·æ±‚å¤±è´¥ï¼ŒçŠ¶æ€ç :{response.status_code}"
    except httpx.RequestError as exc:
        return f"{exc.request.url!r} è¯·æ±‚æ—¶å‡ºç°é”™è¯¯"
    except httpx.HTTPStatusError as exc:
        return f"å½“å‘èµ· {exc.request.url!r} è¯·æ±‚ï¼Œè¿”å›çš„çŠ¶æ€ç ä¸º {exc.response.status_code} "
```

- åœ¨ `system_prompt` å‡½æ•°é€šè¿‡ `run_context` æ¥è·å–åˆ° Deps ä¹Ÿå°±æ˜¯æ‹¿åˆ°è¿æ¥æœåŠ¡çš„å®¢æˆ·ç«¯
- `system_prompt` é€šè¿‡å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚æ‹¿åˆ°æ•°æ®ä½œä¸º context ä¸€éƒ¨åˆ†


ç„¶åå°† system message ç”¨ä¸€ä¸ªå‡½æ•°åŒ…è£¹èµ·æ¥ï¼Œå‡½æ•°å½¢æˆæ¬¢è¿ï¼Œå› ä¸ºåªæœ‰å‡½æ•°åœ¨æ‰§è¡Œæ‰ä¼šç¡®å®šï¼Œä¸ç„¶å‡½æ•°é€šè¿‡å‚æ•°ä¼ å…¥ä¸€äº›ä¸ç¡®å®šå› ç´ ï¼Œè¿™ä¸ª Deps åªè¦è¿è¡Œ Agent æ—¶å€™ï¼Œæ‰§è¡Œ system_message æ‰ä¼šåœ¨è¿è¡Œè·å–æ•°æ®ã€‚


```python
agent = Agent(
    name="deps",
    result_data_type=list[Pokemon]
    )
```

```python
async def main():
    async with httpx.AsyncClient() as client:
        dep = Deps(conn=client,url="https://pokeapi.co/api/v2/pokemon?limit=5")
        
        result = await agent.run("ç»™å‡ºæ¯ä¸€ä¸ª pokemon çš„è§£é‡Šè¯´æ˜",run_context=RunContext(deps=dep))
        print(result.get_data())

if __name__ == "__main__":
    asyncio.run(main=main())
```
- è·å–ä¸€ä¸ªå®¢æˆ·ç«¯(client)
- åˆå§‹ä¾èµ– Deps åœ¨ç±»ä¸­æŒæœ‰å®¢æˆ·ç«¯çš„è¿æ¥ä»¥åŠurl
- åœ¨ system_prompt å‡½æ•°é€šè¿‡ run_context æ¥è·å–åˆ° Deps ä¹Ÿå°±æ˜¯æ‹¿åˆ°è¿æ¥æœåŠ¡çš„å®¢æˆ·ç«¯
- system_prompt é€šè¿‡å®¢æˆ·ç«¯å‘èµ·è¯·æ±‚æ‹¿åˆ°æ•°æ®ä½œä¸º context ä¸€éƒ¨åˆ†


```python
import asyncio
import httpx
from typing import Optional
from dataclasses import dataclass
from pydantic import BaseModel,Field

from azent.core import DeepSeekClient,Agent
from azent.core.run_context import RunContext

url = "https://pokeapi.co/api/v2/pokemon?limit=10"

client = DeepSeekClient(name="deepseek-client")

class Pokemon(BaseModel):
    name:str = Field(title="pokemon name",examples=['Charizard'])
    description:Optional[str] = Field(title="description of pokemon",description="",examples=["æ˜¯ã€Šå®å¯æ¢¦ã€‹ç³»åˆ—ä¸­çš„ç«ç³»é£è¡Œç³»åŒå±æ€§å®å¯æ¢¦ï¼Œå¤–å½¢åƒæ©™è‰²å·¨é¾™ï¼Œå–·ç«èƒ½åŠ›å¼ºï¼Œæ˜¯åˆä»£å¾¡ä¸‰å®¶å°ç«é¾™çš„æœ€ç»ˆè¿›åŒ–å½¢æ€ã€‚"],default="")

# ä¾èµ–æ•°æ®ç»“æ„ï¼Œé€šå¸¸æ˜¯è·å–æ•°æ®çš„å‰æï¼Œä¹Ÿå°±æ˜¯è¿æ¥ç½‘ç»œå’Œè¿æ¥æ•°æ®åº“
@dataclass
class Deps:
    conn:httpx.AsyncClient
    url:str
# system_message é€šè¿‡ context è·å–è·å– dep å€¼
async def system_message(context):
    conn = context['deps'].conn
    response = await conn.get(context['deps'].url)
    # print(response.json()['results'])
    pokemon_list = [ Pokemon(name=item['name'],description="") for item in response.json()['results']]
    
    return f"""
åŸºäº **Pokemon** å‡ºç°çš„ Pokemon ç»™ä¸ç®€å•è¯´æ˜ï¼Œå°±ä¸€å¥è¯
** Pokemon **
{",".join([ pokemon.name for pokemon in pokemon_list])}

"""
# åˆå§‹åŒ– Agent æ—¶å€™æˆ‘ä»¬éœ€è¦æŒ‡å®š Deps
agent = Agent(
    name="deps",
    result_data_type=list[Pokemon]
    )

async def main():
    async with httpx.AsyncClient() as client:
        
        dep = Deps(conn=client,url="https://pokeapi.co/api/v2/pokemon?limit=5")
        
        result = await agent.run("ç»™å‡ºæ¯ä¸€ä¸ª pokemon çš„è§£é‡Šè¯´æ˜",run_context=RunContext(deps=dep))
        print(result.get_data())

if __name__ == "__main__":
    asyncio.run(main=main())
    
```

## å·¥å…·è°ƒç”¨
å‡½æ•°æ˜¯å…¶ä»–æ¨¡å—çš„åŸºç¡€ï¼Œå¯ä»¥çœ‹ä½œ AI Agent æ¡†æ¶æ ¸å¿ƒä¸­çš„æ ¸å¿ƒï¼Œæ‰€ä»¥è¿™ä¸ªæ¨¡å—è®¾è®¡å¥½åä¼šç›´æ¥å½±å“åˆ°ä½¿ç”¨ä½ æ•´ä¸ª AI Agent æ¡†æ¶çš„ä½“éªŒã€‚

åœ¨ azent ä¸­ï¼Œæ”¯æŒå°†å¼‚æ­¥å‡½æ•°å’ŒåŒæ­¥å‡½æ•°ä½œä¸ºå·¥å…·æä¾›ç»™å¤§è¯­è¨€æ¨¡å‹ã€‚
### åŒæ­¥å‡½æ•°çš„è°ƒç”¨
#### å‡†å¤‡å·¥å…·âš™ï¸
æ‰€è°“å·¥å…·ä¹Ÿå°±æ˜¯å‡½æ•°ï¼Œæˆ–è€…ç±»å¯èƒ½æ˜¯ä¸€ä¸ªæ¥å£ã€‚ä¸ºäº†è®©ä¸€ä¸ªå‡½æ•°æˆä¸ºå·¥å…·ï¼Œæˆ‘ä»¬æ˜¯è¦åšé¢å¤–å·¥ä½œã€‚å‡†å¤‡å·¥ä½œä¸»è¦æ˜¯ä¸ºå‡½æ•°çš„å‚æ•°æŒ‡å®šç±»å‹ï¼Œå¯¹äºè¿”å›å€¼ä¹Ÿæ˜¯éœ€è¦æŒ‡å®šç±»å‹çš„ï¼Œå¹¶ä¸”è¦ç»™å‡ºç¬¦åˆ python æ ¼å¼çš„ doc è¯´æ˜ï¼Œä¸ºä»€ä¹ˆè¦è¿™ä¹ˆåšï¼Œä¸€åˆ‡å‡†å¤‡å·¥ä½œéƒ½æ˜¯ä¸ºäº†è®©è¯­è¨€æ¨¡å‹æ›´å¥½åœ°äº†è§£å·¥å…·ï¼Œä»¥ä¾¿åœ¨åˆé€‚çš„æ—¶å€™é€‰æ‹©ä¸€ä¸ªå·¥å…·æ¥ä½¿ç”¨ã€‚
```python
def get_weather(location:str)->float:
    """è·å–æŸä¸ªåŸå¸‚å¤©æ°”çš„æ¸©åº¦
    Args:
        location(str): åŸå¸‚åç§°
    Returns:
        è¿”å›æŸä¸ªåŸå¸‚å¤©æ°”çš„æ¸©åº¦
    """
    print(f"{location=}")
    return 22.0
```
æ³¨å†Œå‡½æ•°æ–¹å¼å¯ä»¥æ˜¾å¼çš„ï¼Œä¹Ÿå¯ä»¥éšå¼æ³¨å†Œ
```python
agent.bind_tool("get_weather",get_weather)
```
ä¹Ÿå¯ä»¥é€šè¿‡ `@agent.tool` è¿™æ ·æ³¨è§£æ–¹å¼æ¥å°†å‡½æ•°ç»‘å®šåˆ°è¯­è¨€æ¨¡å‹
```python
@agent.tool
def get_weather(location:str)->float:

    """è·å–æŸä¸ªåŸå¸‚å¤©æ°”çš„æ¸©åº¦
    Args:
        location(str): åŸå¸‚åç§°
    Returns:
        è¿”å›æŸä¸ªåŸå¸‚å¤©æ°”çš„æ¸©åº¦
    """
    print(f"{location=}")
    return 22.0
```

è¿™é‡Œåšäº†ä¸€äº›ä¼˜åŒ–ï¼Œé€šè¿‡ `ToolManager` ç±»å°†å¯¹äºå·¥å…·ç®¡ç†ä» Agent ç§»å‡ºæ¥ï¼Œé€šè¿‡ä¸€ä¸ªå¤–æ¥å·¥å…·ç®¡ç†å™¨æ¥æ³¨å†Œå·¥å…·ä»¥åŠç®¡ç†å·¥å…·ã€‚ä¹Ÿå°±æ˜¯å‡è½»äº† Agent çš„è´Ÿæ‹…ã€‚æ‰€ä»¥ `tool_manager` è´Ÿè´£å¯¹äºå·¥å…·ç®¡ç†ï¼ŒAgent ä¹Ÿæ˜¯é€šè¿‡ bind_tool å°†å·¥å…·æ·»åŠ åˆ° `tool_manager` ã€‚


```python
async def main():
    result = await agent.run(human_message)

    for tool_message in result.get_message():
        tool_call_result = await agent.tool_manager.execute_tool(tool_message)
        console.print(tool_call_result.output)

if __name__ == "__main__":
    asyncio.run(main=main())
```

- åœ¨ tool_manager æä¾› `execute_tool` ç”¨äºæ‰§è¡Œå‡½æ•°

### å¼‚æ­¥å‡½æ•°è°ƒç”¨

```python

async def get_weather(location:str)->float:

    """è·å–æŸä¸ªåŸå¸‚å¤©æ°”çš„æ¸©åº¦
    Args:
        location(str): åŸå¸‚åç§°
    Returns:
        è¿”å›æŸä¸ªåŸå¸‚å¤©æ°”çš„æ¸©åº¦
    """

    print(f"{location=}")
    await asyncio.sleep(2) 
    return 22.0
```
å¯¹äºå¼‚æ­¥å‡½æ•°çš„ç»‘å®šï¼Œé™¤äº†è¦ç»™å‡½æ•°åç§°ï¼Œä»¥åŠè¦ç»‘å®šå‡½æ•°å¤–ï¼Œè¿˜éœ€è¦ç»™ä¸€ä¸ª `is_async = True`

```python
agent.bind_tool("get_weather",get_weather,is_async=True)
```

```python
async def main():

    result = await agent.run(human_message)
    console.print(result.get_message()[0])
    tool_call_result = await agent.tool_manager.execute_tool(result.get_message()[0])
    console.print(tool_call_result.output)
```
### ä¹Ÿæ”¯æŒ context è¿™æ ·ç»‘å®š
```python
@agent.tool
def get_weather(context,location:str)->float:

    """è·å–æŸä¸ªåŸå¸‚å¤©æ°”çš„æ¸©åº¦
    Args:
        location(str): åŸå¸‚åç§°
    Returns:
        è¿”å›æŸä¸ªåŸå¸‚å¤©æ°”çš„æ¸©åº¦
    """
    # TODO
    print(context['deps']['name'])
    print(f"{location=}")
    return 22.0
```
ä¹Ÿå¯ä»¥å‡†å¤‡è¿™æ ·çš„å·¥å…·ï¼Œä¹Ÿå°±æ˜¯ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ context, è¿™æ ·å·¥å…·åœ¨æ·»åŠ å·¥å…·ä¼šè¿‡æ»¤æ‰ context è¿™ä¸ªå‚æ•°ã€‚å› ä¸ºè¿™ä¸ªå‚æ•°å±äº Agent å†…éƒ¨ä¸Šä¸‹æ–‡å‚æ•°ï¼Œè€Œåœ¨ Agent é€‰æ‹©äº†ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ context çš„å·¥å…·ï¼ŒAgent ä¼šè‡ªåŠ¨è¡¥å…¨è¿™ä¸ªå‚æ•°ã€‚é€šå¸¸æˆ‘ä»¬ä¼šå°†è¿è¡Œæ—¶ contextã€‚

## ä»»åŠ¡æ‰­è½¬

```python
from rich.console import Console
from rich.markdown import Markdown
from rich.panel import Panel

from azent.core import DeepSeekClient,Agent
from azent.core.message import HumanMessage,SystemMessage
from azent.handoff import handoff_with_tool
from azent.tool import result_process
from azent.core.message import HumanMessage,SystemMessage,BaseMessage
from azent.context_manager.default_event_manager import DefaultEventManager
from azent.context_manager import EventType
from azent.utils import run_agent_loop
console = Console()
```

```python

# åˆå§‹åŒ–ä¸€ä¸ª client
client = DeepSeekClient(name="deepseek-client")
```

```python
# å‡†å¤‡ system message å’Œ human message å…±åŒç»„æˆ prompt
system_message = SystemMessage(content="""
å½“æ”¶åˆ°ç”¨æˆ·çš„è¯·æ±‚æ—¶ï¼Œè¯·ä»”ç»†é˜…è¯»å¹¶æ€è€ƒè¿™ä¸ªè¯·æ±‚æœ€é€‚åˆç”±å“ªä¸ªåŠ©æ‰‹æ¥å¤„ç†ã€‚

å¦‚æœç”¨æˆ·çš„è¯·æ±‚æ¶‰åŠåˆ°ä»¥ä¸‹æ–¹é¢ï¼Œè¯·åˆ†é…ç»™ JavaScript ä¸“å®¶ï¼š
- ç½‘é¡µå‰ç«¯å¼€å‘ (HTML, CSS, JavaScript)
- æµè§ˆå™¨è¡Œä¸ºå’Œ DOM æ“ä½œ
- JavaScript æ¡†æ¶å’Œåº“ (å¦‚ React, Angular, Vue.js)
- Node.js åç«¯å¼€å‘
- ä»»ä½•æ˜ç¡®æåŠ JavaScript è¯­è¨€çš„é—®é¢˜

å¦‚æœç”¨æˆ·çš„è¯·æ±‚æ¶‰åŠåˆ°ä»¥ä¸‹æ–¹é¢ï¼Œè¯·åˆ†é…ç»™ Python ä¸“å®¶ï¼š
- Web åç«¯å¼€å‘ (å¦‚ Django, Flask)
- æ•°æ®åˆ†æå’Œå¤„ç† (å¦‚ Pandas, NumPy)
- æœºå™¨å­¦ä¹ å’Œäººå·¥æ™ºèƒ½ (å¦‚ TensorFlow, PyTorch, Scikit-learn)
- è‡ªåŠ¨åŒ–è„šæœ¬å’Œç³»ç»Ÿç®¡ç†
- ä»»ä½•æ˜ç¡®æåŠ Python è¯­è¨€çš„é—®
""")
js_system_message = SystemMessage(content="you are very javascript expert")
py_system_message = SystemMessage(content="you are very python expert")
human_message = HumanMessage(content="ç”¨ JavaScript å†™ä¸€ä¸ªç”Ÿæˆéšæœºæ•°çš„å‡½æ•°")

# åˆå§‹åŒ–ä¸€ä¸ª JavaScript ä¸“å®¶æ™ºèƒ½ä½“
js_agent = Agent(
    name="Js_Agent",
    system_message=js_system_message,
    )

# åˆå§‹åŒ–ä¸€ä¸ª Python ä¸“å®¶æ™ºèƒ½ä½“
py_agent = Agent(
    name="Py_Agent",
    system_message=py_system_message
)

route_agent = Agent(
    name="Triage_Agent",
    system_message=system_message,
    )

def on_handoff(agent_name):
    console.print(agent_name)

@handoff_with_tool(agent=js_agent,on_handoff=on_handoff)
def handoff_js_agent(input:str):
    """å…³äº JavaScript æ–¹é¢ç¼–ç¨‹é—®é¢˜å¯ä»¥è½¬äº¤ç»™å‡½æ•°æ¥å®Œæˆ
    """
    return input
event_manager = DefaultEventManager()
def on_message(message:BaseMessage):
    console.print(Panel(message.content,title="user"))
def on_response(message:BaseMessage):
    console.print(Panel(message.content,title="Assistant"))
    
event_manager.register_observer(EventType.OnMessage,on_message)
event_manager.register_observer(EventType.OnResponse,on_response)

route_agent.bind_tool("handoff_js_agent",handoff_js_agent)
console.print(route_agent.available_tools)
result = route_agent.sync_run(human_message)
result_process(route_agent,result,event_manager,auto_call_agent=False)
```
## è®°å¿†æœºåˆ¶
- è®°å¿†ç»†èƒ
- è®°å¿†ç¢ç‰‡
- è®°å¿†å¡ç‰‡
